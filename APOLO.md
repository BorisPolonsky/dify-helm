# Apolo Dify.ai deployment

Currently, we only support deployment with:
Database:
- [x] external PostgreSQL (running as an app, see https://github.com/neuro-inc/app-crunchy-postgres)

Objects persistance:
- platform object storage with
  - [x] S3-compatible backend (AWS S3 / MinIO)

Vector store:
- [x] external PGVector (running as an app, see https://github.com/neuro-inc/app-crunchy-postgres)

Other system components like LLM inference, reranker, embeddings services are deployed as platform apps too and integrated via web interface of Dify. However, automation for those integrations is planned too.


## Platform deploymet example:
```yaml
apolo run --pass-config ghcr.io/neuro-inc/app-deployment -- install https://github.com/neuro-inc/dify-helm \
  dify mydifyinstance charts/dify \
  --set timeout=600 \
  --set "api.replicas=1" \
  --set "api.preset_name=cpu-small" \
  --set "api.secretKey=EncryptionKeyToSignCookies" \    # autogenerated
  --set "worker.replicas=1" \
  --set "worker.preset_name=cpu-small" \
  --set "proxy.replicas=1" \        # TODO: implement ingress replacement for proxy
  --set "proxy.preset_name=cpu-small" \
  --set "web.replicas=1" \
  --set "web.preset_name=cpu-small" \
  --set "redis.auth.password=SomePasswordYouGenerated" \ # TODO: investigate dedicated app deployment
  --set "redis.master.preset_name=cpu-small" \
  --set "redis.replica.replicaCount=1" \
  --set "redis.replica.preset_name=cpu-small" \
  --set "externalPostgres.username=PGUsername" \    # autofilled
  --set "externalPostgres.password=PGPassword" \    # autofilled
  --set "externalPostgres.address=PGHostname" \ # autofilled
  --set "externalPostgres.port=5432" \  # autofilled
  --set "externalPostgres.dbName=PGDBName" \
  --set "externalPostgres.platformAppName=myappname" \ # TODO: PGVector app name to integrate with
  --set "externalS3.enabled=true" \ # autofilled
  --set "externalS3.endpoint=BucketEndpoint" \  # autofilled
  --set "externalS3.accessKey=AccessKey" \  # autofilled
  --set "externalS3.secretKey=SecretKey" \  # autofilled
  --set "externalS3.bucketName=platformBucketName" \ # TODO: Platform bucket name to use for persistance
  --set "externalPgvector.username=PGUsername" \    # autofilled
  --set "externalPgvector.password=PGPassword" \    # autofilled
  --set "externalPgvector.address=PGHostname" \ # autofilled
  --set "externalPgvector.port=5432" \  # autofilled
  --set "externalPgvector.dbName=PGDBName" \    # autofilled
  --set "externalPgvector.platformAppName=myappname" # TODO: PGVector app name to integrate with
```
